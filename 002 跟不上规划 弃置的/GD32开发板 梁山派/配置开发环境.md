### cross compilation for 不同架构的微控制器
参考用户手册，获取架构信息
[[GD32F4xx_User_Manual_Rev3.0_CN.pdf]]
[[GD32F4xx_User_Manual_Rev3.0.pdf]]
Cortex-M4,
到arm官网查看架构
[Cortex-M4官网](https://developer.arm.com/Processors/Cortex-M4)
- Armv7E-M:Architecture
- [Thumb or Thumb-2](https://developer.arm.com/architectures/instruction-sets)
去rust支持页面，找到对应架构 thumb armv7
 [thumbv7em-none-eabi](https://doc.rust-lang.org/stable/rustc/platform-support/thumbv7em-none-eabi.html#thumbv7em-none-eabi-and-thumbv7em-none-eabihf)
 //和eabihf版，hardfloat
 》我需要eabihf版，经查官网，有符合IEEE754标准，即硬件浮点数计算

```
rustup target add thumbv7em-non-eabihf

rustup show
```
猜想：安装另一平台的编辑器
> rustup不要和cargo混淆
### 程序部分
main()不适合没有操作系统的环境
[cortex-m-rt : A minimal runtime for microcontrollers](https://docs.rs/cortex-m-rt/0.7.5/cortex_m_rt/)
我需要提供`memory.x` 文件，包括了`memory layout` 
`memory.x`至少包括Flash和Ram两个定义，查找memory map在user  manual发现：flash开始0x0800 0000，共3072kb->参考嘉立创1024kb，SRAM开始于0x2000 0000，参考嘉立创512kb

》`warning: spurious network error (3 tries remaining): [35] SSL connect error (Recv failure: Connection was reset)`
~~说明cargo版本太低~~
	没有解决，我应该修改代理设置
```
[source.ustc]
registry = "git://mirrors.ustc.edu.cn/crates.io-index"`
```

```
#[Entry]
fn main -> ! {
	loop{}
}
```

[[通过.cargo和.vscode配置cargo或analyzer]]

》error: `#[panic_handler]` function required, but not found
`cargo add panic-halt`一个库，但什么也不做
<ctrl+~调出terminal更加快捷

### 准备输出到微控制器
`rustup component add llvm-tools`
`cargo install cargo-binutils`
~~`cargo install cargo-embed`~~
[[cargo-embed即probe-rs]]


# probe-rs并不支持所用芯片
~~我应该转而采用arm的extension方式。~~
~~云开发了。~~
云上并没有合适的target预配置。
~~转而使用GigaDevice提供的EmbeddedBuilder了。~~
典型的垃圾软件，具有 1. Java写的 2. 不支持开箱急用
keil开发的也是垃圾软件。

最终用了Keil5，配置过程非常繁琐，所以并无有替代。